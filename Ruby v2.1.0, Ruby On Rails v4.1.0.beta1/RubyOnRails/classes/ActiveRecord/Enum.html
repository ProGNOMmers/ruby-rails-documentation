<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveRecord::Enum</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
            <span>Ruby on Rails 4.1.0.beta1</span><br />
        
        <h1>
            <span class="type">Module</span> 
            ActiveRecord::Enum 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord/lib/active_record/enum_rb.html">activerecord/lib/active_record/enum.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Declare an enum attribute where the values map to integers in the database,
but can be queried by name. Example:</p>

<pre><code>class Conversation &lt; ActiveRecord::Base
  enum status: [ :active, :archived ]
end

# conversation.update! status: 0
conversation.active!
conversation.active? # =&gt; true
conversation.status  # =&gt; &quot;active&quot;

# conversation.update! status: 1
conversation.archived!
conversation.archived? # =&gt; true
conversation.status    # =&gt; &quot;archived&quot;

# conversation.update! status: 1
conversation.status = &quot;archived&quot;
</code></pre>

<p>You can set the default value from the database declaration, like:</p>

<pre><code>create_table :conversations do |t|
  t.column :status, :integer, default: 0
end
</code></pre>

<p>Good practice is to let the first declared status be the default.</p>

<p>Finally, it&#39;s also possible to explicitly map the relation between
attribute and database integer with a <code>Hash</code>:</p>

<pre><code>class Conversation &lt; ActiveRecord::Base
  enum status: { active: 0, archived: 1 }
end
</code></pre>

<p>Note that when an <code>Array</code> is used, the implicit mapping from the
values to database integers is derived from the order the values appear in
the array. In the example, <code>:active</code> is mapped to <code>0</code>
as it&#39;s the first element, and <code>:archived</code> is mapped to
<code>1</code>. In general, the <code>i</code>-th element is mapped to
<code>i-1</code> in the database.</p>

<p>Therefore, once a value is added to the enum array, its position in the
array must be maintained, and new values should only be added to the end of
the array. To remove unused values, the explicit <code>Hash</code> syntax
should be used.</p>

<p>In rare circumstances you might need to access the mapping directly. The
mappings are exposed through a constant with the attributes name:</p>

<pre><code>Conversation::STATUS # =&gt; { &quot;active&quot; =&gt; 0, &quot;archived&quot; =&gt; 1 }
</code></pre>

<p>Use that constant when you need to know the ordinal value of an enum:</p>

<pre><code>Conversation.where(&quot;status &lt;&gt; ?&quot;, Conversation::STATUS[:archived])</code></pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-_enum_methods_module">_enum_methods_module</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-enum">enum</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-enum">
            
              <b>enum</b>(definitions)
            
            <a href="../../classes/ActiveRecord/Enum.html#method-i-enum" name="method-i-enum" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-enum_source')" id="l_method-i-enum_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/8cfab46837f66587c3cdb5ea40a0d968fd3e1b15/activerecord/lib/active_record/enum.rb#L55" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-enum_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/enum.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">enum</span>(<span class="ruby-identifier">definitions</span>)
  <span class="ruby-identifier">klass</span> = <span class="ruby-keyword">self</span>
  <span class="ruby-identifier">definitions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># DIRECTION = { }</span>
    <span class="ruby-identifier">enum_values</span> = <span class="ruby-identifier">_enum_methods_module</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>

    <span class="ruby-identifier">_enum_methods_module</span>.<span class="ruby-identifier">module_eval</span> <span class="ruby-keyword">do</span>
      <span class="ruby-comment"># def direction=(value) self[:direction] = DIRECTION[value] end</span>
      <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{name}=&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">enum_values</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">value</span>)
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;&#39;#{value}&#39; is not a valid #{name}&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">self</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">enum_values</span>[<span class="ruby-identifier">value</span>]
      }

      <span class="ruby-comment"># def direction() DIRECTION.key self[:direction] end</span>
      <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">name</span>) { <span class="ruby-identifier">enum_values</span>.<span class="ruby-identifier">key</span> <span class="ruby-keyword">self</span>[<span class="ruby-identifier">name</span>] }

      <span class="ruby-identifier">pairs</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:each_pair</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each_with_index</span>
      <span class="ruby-identifier">pairs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">enum_values</span>[<span class="ruby-identifier">value</span>] = <span class="ruby-identifier">i</span>

        <span class="ruby-comment"># scope :incoming, -&gt; { where direction: 0 }</span>
        <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">scope</span> <span class="ruby-identifier">value</span>, <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">where</span> <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span> }

        <span class="ruby-comment"># def incoming?() direction == 0 end</span>
        <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{value}?&quot;</span>) { <span class="ruby-keyword">self</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">i</span> }

        <span class="ruby-comment"># def incoming! update! direction: :incoming end</span>
        <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{value}!&quot;</span>) { <span class="ruby-identifier">update!</span> <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span> }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
              
      <div class="sectiontitle">Instance Private methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-_enum_methods_module">
            
              <b>_enum_methods_module</b>()
            
            <a href="../../classes/ActiveRecord/Enum.html#method-i-_enum_methods_module" name="method-i-_enum_methods_module" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_enum_methods_module_source')" id="l_method-i-_enum_methods_module_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/8cfab46837f66587c3cdb5ea40a0d968fd3e1b15/activerecord/lib/active_record/enum.rb#L92" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-_enum_methods_module_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/enum.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_enum_methods_module</span>
  <span class="ruby-ivar">@_enum_methods_module</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">include</span> <span class="ruby-identifier">mod</span>
    <span class="ruby-identifier">mod</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    