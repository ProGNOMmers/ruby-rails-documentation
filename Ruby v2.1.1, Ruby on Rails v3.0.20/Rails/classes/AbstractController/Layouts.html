<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>AbstractController::Layouts</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
            <span>Ruby on Rails 3.0.20</span><br />
        
        <h1>
            <span class="type">Module</span> 
            AbstractController::Layouts 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/actionpack/lib/abstract_controller/layouts_rb.html">actionpack/lib/abstract_controller/layouts.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><a href="Layouts.html">Layouts</a> reverse the common pattern of including
shared headers and footers in many templates to isolate changes in repeated
setups. The inclusion pattern has pages that look like this:</p>

<pre><code>&lt;%= render &quot;shared/header&quot; %&gt;
Hello World
&lt;%= render &quot;shared/footer&quot; %&gt;</code></pre>

<p>This approach is a decent way of keeping common structures isolated from
the changing content, but it&#39;s verbose and if you ever want to change
the structure of these two includes, you&#39;ll have to change all the
templates.</p>

<p>With layouts, you can flip it around and have the common structure know
where to insert changing content. This means that the header and footer are
only mentioned in one place, like this:</p>

<pre><code>// The header part of this layout
&lt;%= yield %&gt;
// The footer part of this layout</code></pre>

<p>And then you have content pages that look like this:</p>

<pre><code>hello world</code></pre>

<p>At rendering time, the content page is computed and then inserted in the
layout, like this:</p>

<pre><code>// The header part of this layout
hello world
// The footer part of this layout</code></pre>

<h2 id="module-AbstractController::Layouts-label-Accessing+shared+variables">Accessing shared variables</h2>

<p><a href="Layouts.html">Layouts</a> have access to variables specified in
the content pages and vice versa. This allows you to have layouts with
references that won&#39;t materialize before rendering time:</p>

<pre><code>&lt;h1&gt;&lt;%= @page_title %&gt;&lt;/h1&gt;
&lt;%= yield %&gt;</code></pre>

<p>…and content pages that fulfill these references <em>at</em> rendering
time:</p>

<pre><code>&lt;% @page_title = &quot;Welcome&quot; %&gt;
Off-world colonies offers you a chance to start a new life</code></pre>

<p>The result after rendering is:</p>

<pre><code>&lt;h1&gt;Welcome&lt;/h1&gt;
Off-world colonies offers you a chance to start a new life</code></pre>

<h2 id="module-AbstractController::Layouts-label-Layout+assignment">Layout assignment</h2>

<p>You can either specify a layout declaratively (using the layout class
method) or give it the same name as your controller, and place it in
<code>app/views/layouts</code>. If a subclass does not have a layout
specified, it inherits its layout using normal Ruby inheritance.</p>

<p>For instance, if you have PostsController and a template named
<code>app/views/layouts/posts.html.erb</code>, that template will be used
for all actions in PostsController and controllers inheriting from
PostsController.</p>

<p>If you use a module, for instance Weblog::PostsController, you will need a
template named <code>app/views/layouts/weblog/posts.html.erb</code>.</p>

<p>Since all your controllers inherit from <a
href="../ApplicationController.html">ApplicationController</a>, they will
use <code>app/views/layouts/application.html.erb</code> if no other layout
is specified or provided.</p>

<h2 id="module-AbstractController::Layouts-label-Inheritance+Examples">Inheritance Examples</h2>

<pre><code>class BankController &lt; ActionController::Base
  layout &quot;bank_standard&quot;

class InformationController &lt; BankController

class TellerController &lt; BankController
  # teller.html.erb exists

class TillController &lt; TellerController

class VaultController &lt; BankController
  layout :access_level_layout

class EmployeeController &lt; BankController
  layout nil
</code></pre>

<p>The InformationController uses “bank_standard” inherited from the
BankController, the VaultController overwrites and picks the layout
dynamically, and the EmployeeController doesn&#39;t want to use a layout at
all.</p>

<p>The TellerController uses <code>teller.html.erb</code>, and TillController
inherits that layout and uses it as well.</p>

<h2 id="module-AbstractController::Layouts-label-Types+of+layouts">Types of layouts</h2>

<p><a href="Layouts.html">Layouts</a> are basically just regular templates,
but the name of this template needs not be specified statically. Sometimes
you want to alternate layouts depending on runtime information, such as
whether someone is logged in or not. This can be done either by specifying
a method reference as a symbol or using an inline method (as a proc).</p>

<p>The method reference is the preferred approach to variable layouts and is
used like this:</p>

<pre><code>class WeblogController &lt; ActionController::Base
  layout :writers_and_readers

  def index
    # fetching posts
  end

  private
    def writers_and_readers
      logged_in? ? &quot;writer_layout&quot; : &quot;reader_layout&quot;
    end
</code></pre>

<p>Now when a new request for the index action is processed, the layout will
vary depending on whether the person accessing is logged in or not.</p>

<p>If you want to use an inline method, such as a proc, do something like
this:</p>

<pre><code>class WeblogController &lt; ActionController::Base
  layout proc{ |controller| controller.logged_in? ? &quot;writer_layout&quot; : &quot;reader_layout&quot; }
end
</code></pre>

<p>Of course, the most common way of specifying a layout is still just as a
plain template name:</p>

<pre><code>class WeblogController &lt; ActionController::Base
  layout &quot;weblog_standard&quot;
end
</code></pre>

<p>If no directory is specified for the template name, the template will by
default be looked for in <code>app/views/layouts/</code>. Otherwise, it
will be looked up relative to the template root.</p>

<h2 id="module-AbstractController::Layouts-label-Conditional+layouts">Conditional layouts</h2>

<p>If you have a layout that by default is applied to all the actions of a
controller, you still have the option of rendering a given action or set of
actions without a layout, or restricting a layout to only a single action
or a set of actions. The <code>:only</code> and <code>:except</code>
options can be passed to the layout call. For example:</p>

<pre><code>class WeblogController &lt; ActionController::Base
  layout &quot;weblog_standard&quot;, :except =&gt; :rss

  # ...

end
</code></pre>

<p>This will assign “weblog_standard” as the WeblogController&#39;s layout 
except for the <code>rss</code> action, which will not wrap a layout around
the rendered view.</p>

<p>Both the <code>:only</code> and <code>:except</code> condition can accept
an arbitrary number of method references, so #<code>:except =&gt; [ :rss,
:text_only ]</code> is valid, as is <code>:except =&gt; :rss</code>.</p>

<h2 id="module-AbstractController::Layouts-label-Using+a+different+layout+in+the+action+render+call">Using a different layout in the action render call</h2>

<p>If most of your actions use the same layout, it makes perfect sense to
define a controller-wide layout as described above. Sometimes you&#39;ll
have exceptions where one action wants to use a different layout than the
rest of the controller. You can do this by passing a <code>:layout</code>
option to the <code>render</code> call. For example:</p>

<pre><code>class WeblogController &lt; ActionController::Base
  layout &quot;weblog_standard&quot;

  def help
    render :action =&gt; &quot;help&quot;, :layout =&gt; &quot;help&quot;
  end
end
</code></pre>

<p>This will render the help action with the “help” layout instead of the
controller-wide “weblog_standard” layout.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="Layouts/ClassMethods.html">AbstractController::Layouts::ClassMethods</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-_default_layout">_default_layout</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_include_layout-3F">_include_layout?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_layout">_layout</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_layout_for_option">_layout_for_option</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_normalize_options">_normalize_options</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-action_has_layout-3F">action_has_layout?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="Rendering.html">
              AbstractController::Rendering
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>action_has_layout</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>(*)
            
            <a href="../../classes/AbstractController/Layouts.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L297" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>(<span class="ruby-operator">*</span>)
  <span class="ruby-ivar">@action_has_layout</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-_normalize_options">
            
              <b>_normalize_options</b>(options)
            
            <a href="../../classes/AbstractController/Layouts.html#method-i-_normalize_options" name="method-i-_normalize_options" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_normalize_options_source')" id="l_method-i-_normalize_options_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L285" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-_normalize_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_normalize_options</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">super</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">_include_layout?</span>(<span class="ruby-identifier">options</span>)
    <span class="ruby-identifier">layout</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:layout</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:layout</span>) <span class="ruby-operator">:</span> <span class="ruby-value">:default</span>
    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">_layout_for_option</span>(<span class="ruby-identifier">layout</span>)
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:layout</span>] = (<span class="ruby-identifier">value</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\blayouts/</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;layouts/#{value}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-action_has_layout-3F">
            
              <b>action_has_layout?</b>()
            
            <a href="../../classes/AbstractController/Layouts.html#method-i-action_has_layout-3F" name="method-i-action_has_layout-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-action_has_layout-3F_source')" id="l_method-i-action_has_layout-3F_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L302" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-action_has_layout-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">action_has_layout?</span>
  <span class="ruby-ivar">@action_has_layout</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
              
      <div class="sectiontitle">Instance Private methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-_default_layout">
            
              <b>_default_layout</b>(require_layout = false)
            
            <a href="../../classes/AbstractController/Layouts.html#method-i-_default_layout" name="method-i-_default_layout" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the default layout for this controller and a given set of details.
Optionally raises an exception if the layout could not be found.</p>

<h4 id="method-i-_default_layout-label-Parameters">Parameters</h4>
<ul><li>
<p><code>details</code> - A list of details to restrict the search by. This
might include details like the format or locale of the template.</p>
</li><li>
<p><code>require_logout</code> - If this is true, raise an ArgumentError with
details about the fact that the exception could not be found (defaults to
false)</p>
</li></ul>

<h4 id="method-i-_default_layout-label-Returns">Returns</h4>
<ul><li>
<p><code>template</code> - The template object for the default layout (or nil)</p>
</li></ul>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_default_layout_source')" id="l_method-i-_default_layout_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L343" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-_default_layout_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 343</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_default_layout</span>(<span class="ruby-identifier">require_layout</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">layout_name</span> = <span class="ruby-identifier">_layout</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">action_has_layout?</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NameError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoMethodError</span>,
      <span class="ruby-node">&quot;You specified #{@_layout.inspect} as the layout, but no such method was found&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">require_layout</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">action_has_layout?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">layout_name</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>,
      <span class="ruby-node">&quot;There was no default layout for #{self.class} in #{view_paths.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">layout_name</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_include_layout-3F">
            
              <b>_include_layout?</b>(options)
            
            <a href="../../classes/AbstractController/Layouts.html#method-i-_include_layout-3F" name="method-i-_include_layout-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_include_layout-3F_source')" id="l_method-i-_include_layout-3F_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L359" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-_include_layout-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_include_layout?</span>(<span class="ruby-identifier">options</span>)
  (<span class="ruby-identifier">options</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">&amp;</span> [<span class="ruby-value">:text</span>, <span class="ruby-value">:inline</span>, <span class="ruby-value">:partial</span>]).<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:layout</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_layout">
            
              <b>_layout</b>()
            
            <a href="../../classes/AbstractController/Layouts.html#method-i-_layout" name="method-i-_layout" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>This will be overwritten by _write_layout_method</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_layout_source')" id="l_method-i-_layout_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L309" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-_layout_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_layout</span>; <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_layout_for_option">
            
              <b>_layout_for_option</b>(name)
            
            <a href="../../classes/AbstractController/Layouts.html#method-i-_layout_for_option" name="method-i-_layout_for_option" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Determine the layout for a given name and details, taking into account the
name type.</p>

<h4 id="method-i-_layout_for_option-label-Parameters">Parameters</h4>
<ul><li>
<p><code>name</code> - The name of the template</p>
</li><li>
<p><code>details</code> - A list of details to restrict the lookup to. By
default, layout lookup is limited to the formats specified for the current
request.</p>
</li></ul>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_layout_for_option_source')" id="l_method-i-_layout_for_option_source">show</a>
                
                  | <a href="https://github.com/mdesantis/rails/blob/e6f2ef3a155edf15cf52b9e548160ca6881b2012/actionpack/lib/abstract_controller/layouts.rb#L319" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-_layout_for_option_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/abstract_controller/layouts.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_layout_for_option</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>     <span class="ruby-keyword">then</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>       <span class="ruby-keyword">then</span> <span class="ruby-identifier">_default_layout</span>(<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-value">:default</span>   <span class="ruby-keyword">then</span> <span class="ruby-identifier">_default_layout</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>, <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>,
      <span class="ruby-node">&quot;String, true, or false, expected for `layout&#39;; you passed #{name.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    