<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            CHANGELOG.md
        </h1>
        <ul class="files">
            <li>activerecord/CHANGELOG.md</li>
            <li>Last modified: 2014-04-18 18:03:28 +0200</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+3.2.15+%28Oct+16%2C+2013%29">Rails 3.2.15 (Oct 16, 2013)</h2>
<ul><li>
<p>When calling the method .find_or_initialize_by_* from a collection_proxy it
should set the inverse_of relation even when the entry was found on the db.</p>

<p><em>arthurnn</em></p>
</li><li>
<p>Callbacks on has_many should access the in memory parent if a inverse_of is
set.</p>

<p><em>arthurnn</em></p>
</li><li>
<p>Fix <code>FinderMethods#last</code> unscoped primary key.</p>

<p>Fixes #11917.</p>

<p><em>Eugene Kalenkovich</em></p>
</li><li>
<p>Load fixtures from linked folders.</p>

<p><em>Kassio Borges</em></p>
</li><li>
<p>When using optimistic locking, <code>update</code> was not passing the
column to <code>quote_value</code> to allow the connection adapter to
properly determine how to quote the value. This was affecting certain
databases that use specific colmn types.</p>

<p>Fixes: #6763</p>

<p><em>Alfred Wong</em></p>
</li></ul>

<h2 id="label-Rails+3.2.14+%28Jul+22%2C+2013%29">Rails 3.2.14 (Jul 22, 2013)</h2>
<ul><li>
<p>Fix merge error when Equality LHS is non-attribute. Backport of #7380.</p>

<p><em>Karmes Alexander</em></p>
</li><li>
<p>Do not re-create destroyed association when saving the parent object.</p>

<p>Fixes #11450.</p>

<p><em>Paul Nikitochkin</em></p>
</li><li>
<p>Do not shallow the original exception in <code>exec_cache</code> on
PostgreSQL adapter.</p>

<p>Fixes #11260.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Fix <code>ActiveRecord::Store</code> incorrectly tracking changes of its
attributes. Fixes #10373.</p>

<p><em>Janko Marohnić</em></p>
</li><li>
<p>Fix a bug that prevented the use of the default STI inheritance column
(ActiveRecord::Base.inheritance_column = &#39;some_column&#39;.)</p>

<p><em>chapmajs + Takehiro Adachi</em></p>
</li><li>
<p>Fix mysql2 adapter raises the correct exception when executing a query on a
closed connection.</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>Fixes bug where <code>Company.new.contract_ids</code> would incorrectly
load all non-associated contracts.</p>

<p>Example:</p>

<pre><code>company = Company.new # Company has many :contracts

# before
company.contract_ids # =&gt; SELECT ... WHERE `contracts`.`company_id` IS NULL

# after
company.contract_ids # =&gt; []
</code></pre>

<p><em>Jared Armstrong</em></p>
</li><li>
<p>Fix the <code>:primary_key</code> option for <code>has_many</code>
associations. Fixes #10693.</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>fixes bug introduced by #3329. Now, when autosaving associations, deletions
happen before inserts and saves. This prevents a &#39;duplicate unique
value&#39; database error that would occur if a record being created had
the same value on a unique indexed field as that of a record being
destroyed.</p>

<p>Backport of #10417</p>

<p><em>Johnny Holton</em></p>
</li><li>
<p>Fix that under some conditions, Active Record could produce invalid SQL of
the sort: "SELECT DISTINCT DISTINCT".</p>

<p>Backport of #6792.</p>

<p><em>Ben Woosley</em></p>
</li><li>
<p>Require <code>ActiveRecord::Base</code> in railtie hooks for rake_tasks,
console and runner to avoid circular constant loading issues.</p>

<p>Backport #7695.</p>

<p>Fixes #7683 and #882</p>

<p><em>Ben Holley</em></p>
</li><li>
<p>Maintain context for joins within <a
href="../../classes/ActiveRecord/Relation.html">ActiveRecord::Relation</a>
merges. Backport #10164.</p>

<p><em>Neeraj Singh + Andrew Horner</em></p>
</li><li>
<p>Make sure the <code>EXPLAIN</code> command is never triggered by a
<code>select_db</code> call.</p>

<p><em>Daniel Schierbeck</em></p>
</li><li>
<p>Revert changes on <code>pluck</code> that was ignoring the select clause
when the relation already has one. This caused a regression since it
changed the behavior in a stable release.</p>

<p>Fixes #9777.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Confirm a record has not already been destroyed before decrementing counter
cache.</p>

<p><em>Ben Tucker</em></p>
</li><li>
<p>Default values for PostgreSQL bigint types now get parsed and dumped to the
schema correctly. Backport #10098.</p>

<p><em>Erik Peterson</em></p>
</li><li>
<p>Removed warning when <code>auto_explain_threshold_in_seconds</code> is set
and the connection adapter doesn&#39;t support explain. This is causing a
regression since the Active Record Railtie is trying to connect to the
development database in the application boot.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Do not reset <code>inheritance_column</code> when it&#39;s set explicitly.
Backport of #5327.</p>

<p><em>kennyj + Fred Wu</em></p>
</li><li>
<p>Fix a problem wrong exception is occured when raising no translatable
exception in PostgreSQL.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Resets the postgres search path in the structure.sql after the structure is
dumped in order to find schema_migrations table when multiples schemas are
used. Fixes #9796.</p>

<p><em>Juan M. Cuello + Dembskiy Alexander</em></p>
</li><li>
<p>Reload the association target if it&#39;s stale. <code>@stale_state</code>
should be nil when a model isn&#39;t saved. Fixes #7526.</p>

<p><em>Larry Lv</em></p>
</li><li>
<p>Don&#39;t read CSV files during execution of <code>db:fixtures:load</code>.
CSV support for fixtures was removed some time ago but the task was still
loading them, even though later the code was looking for the related yaml
file instead.</p>

<p><em>kennyj</em></p>
</li></ul>

<h2 id="label-Rails+3.2.13+%28Mar+18%2C+2013%29">Rails 3.2.13 (Mar 18, 2013)</h2>
<ul><li>
<p>Chaining multiple preloaded scopes will correctly preload all the scopes at
the same time.</p>

<p><em>Chris Geihsler</em></p>
</li><li>
<p>Reverted 921a296a3390192a71abeec6d9a035cc6d1865c8, &#39;Quote numeric
values compared to string columns.&#39; This caused several regressions.</p>

<p><em>Steve Klabnik</em></p>
</li><li>
<p>Fix overriding of attributes by <code>default_scope</code> on
<code>ActiveRecord::Base#dup</code>.</p>

<p><em>Hiroshige UMINO</em></p>
</li><li>
<p>Fix issue with overriding Active Record reader methods with a composed
object and using that attribute as the scope of a
<code>uniqueness_of</code> validation. Backport #7072.</p>

<p><em>Peter Brown</em></p>
</li><li>
<p>Sqlite now preserves custom primary keys when copying or altering tables.
Fixes #9367. Backport #2312.</p>

<p><em>Sean Scally + Yves Senn</em></p>
</li><li>
<p>Preloading <code>has_many :through</code> associations with conditions
won&#39;t cache the <code>:through</code> association. This will prevent
invalid subsets to be cached. Fixes #8423. Backport #9252.</p>

<p>Example:</p>

<pre><code>class User
  has_many :posts
  has_many :recent_comments, -&gt; { where(&#39;created_at &gt; ?&#39;, 1.week.ago) }, :through =&gt; :posts
end

a_user = User.includes(:recent_comments).first

# this is preloaded
a_user.recent_comments

# fetching the recent_comments through the posts association won&#39;t preload it.
a_user.posts
</code></pre>

<p><em>Yves Senn</em></p>
</li><li>
<p>Fix handling of dirty time zone aware attributes</p>

<p>Previously, when <code>time_zone_aware_attributes</code> were enabled,
after changing a datetime or timestamp attribute and then changing it back
to the original value, <code>changed_attributes</code> still tracked the
attribute as changed. This caused <code>[attribute]_changed?</code> and
<code>changed?</code> methods to return true incorrectly.</p>

<p>Example:</p>

<pre><code>in_time_zone &#39;Paris&#39; do
  order = Order.new
  original_time = Time.local(2012, 10, 10)
  order.shipped_at = original_time
  order.save
  order.changed? # =&gt; false

  # changing value
  order.shipped_at = Time.local(2013, 1, 1)
  order.changed? # =&gt; true

  # reverting to original value
  order.shipped_at = original_time
  order.changed? # =&gt; false, used to return true
end
</code></pre>

<p>Backport of #9073 Fixes #8898</p>

<p><em>Lilibeth De La Cruz</em></p>
</li><li>
<p>Fix counter cache columns not updated when replacing <code>has_many
:through</code> associations. Backport #8400. Fix #7630.</p>

<p><em>Matthew Robertson</em></p>
</li><li>
<p>Don&#39;t update <code>column_defaults</code> when calling destructive
methods on column with default value. Backport c517602. Fix #6115.</p>

<p><em>Piotr Sarnacki + Aleksey Magusev + Alan Daud</em></p>
</li><li>
<p>When <code>#count</code> is used in conjunction with <code>#uniq</code> we
perform <code>count(:distinct =&gt; true)</code>. Fix #6865.</p>

<p>Example:</p>

<p>relation.uniq.count # =&gt; SELECT COUNT(DISTINCT *)</p>

<p><em>Yves Senn + Kaspar Schiess</em></p>
</li><li>
<p>Fix <code>ActiveRecord::Relation#pluck</code> when columns or tables are
reserved words. Backport #7536. Fix #8968.</p>

<p><em>Ian Lesperance + Yves Senn + Kaspar Schiess</em></p>
</li><li>
<p>Don&#39;t run explain on slow queries for database adapters that don&#39;t
support it. Backport #6197.</p>

<p><em>Blake Smith</em></p>
</li><li>
<p>Revert round usec when comparing timestamp attributes in the dirty
tracking. Fixes #8460.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Revert creation of through association models when using
<code>collection=[]</code> on a <code>has_many :through</code> association
from an unsaved model. Fix #7661, #8269.</p>

<p><em>Ernie Miller</em></p>
</li><li>
<p>Fix undefined method <code>to_i</code> when calling <code>new</code> on a
scope that uses an <a href="../../classes/Array.html">Array</a>; Fix
FloatDomainError when setting integer column to NaN. Fixes #8718, #8734,
#8757.</p>

<p><em>Jason Stirk + Tristan Harward</em></p>
</li><li>
<p>Serialized attributes can be serialized in integer columns. Fix #8575.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Keep index names when using <code>alter_table</code> with sqlite3. Fix
#3489. Backport #8522.</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>Recognize migrations placed in directories containing numbers and
&#39;rb&#39;. Fix #8492. Backport of #8500.</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>Add <code>ActiveRecord::Base.cache_timestamp_format</code> class attribute
to control the format of the timestamp value in the cache key. This allows
users to improve the precision of the cache key. Fixes #8195.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Add <code>:nsec</code> date format. This can be used to improve the
precision of cache key. Please note that this format only works with Ruby
1.9, Ruby 1.8 will ignore it completely.</p>

<p><em>Jamie Gaskins</em></p>
</li><li>
<p>Unscope <code>update_column(s)</code> query to ignore default scope.</p>

<p>When applying <code>default_scope</code> to a class with a where clause,
using <code>update_column(s)</code> could generate a query that would not
properly update the record due to the where clause from the
<code>default_scope</code> being applied to the update query.</p>

<pre><code>class User &lt; ActiveRecord::Base
  default_scope where(active: true)
end

user = User.first
user.active = false
user.save!

user.update_column(:active, true) # =&gt; false
</code></pre>

<p>In this situation we want to skip the default_scope clause and just update
the record based on the primary key. With this change:</p>

<pre><code>user.update_column(:active, true) # =&gt; true
</code></pre>

<p>Backport of #8436 fix.</p>

<p><em>Carlos Antonio da Silva</em></p>
</li><li>
<p>Fix performance problem with primary_key method in PostgreSQL adapter when
having many schemas. Uses pg_constraint table instead of pg_depend table
which has many records in general. Fix #8414</p>

<p><em>kennyj</em></p>
</li><li>
<p>Do not instantiate intermediate Active Record objects when eager loading.
These records caused <code>after_find</code> to run more than expected. Fix
#3313 Backport of #8403</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>Fix <code>pluck</code> to work with joins. Backport of #4942.</p>

<p><em>Carlos Antonio da Silva</em></p>
</li><li>
<p>Fix a problem with <code>translate_exception</code> method in a non English
environment. Backport of #6397.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Fix dirty attribute checks for TimeZoneConversion with nil and blank
datetime attributes. Setting a nil datetime to a blank string should not
result in a change being flagged. Fixes #8310. Backport of #8311.</p>

<p><em>Alisdair McDiarmid</em></p>
</li><li>
<p>Prevent mass assignment to the type column of polymorphic associations when
using <code>build</code>. Fixes #8265. Backport of #8291.</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>When running migrations on Postgresql, the <code>:limit</code> option for
<code>binary</code> and <code>text</code> columns is silently dropped.
Previously, these migrations caused sql exceptions, because Postgresql
doesn&#39;t support limits on these types.</p>

<p><em>Victor Costan</em></p>
</li><li>
<p><code>#pluck</code> can be used on a relation with <code>select</code>
clause. Fixes #7551. Backport of #8176.</p>

<p>Example:</p>

<pre><code>Topic.select([:approved, :id]).order(:id).pluck(:id)</code></pre>

<p><em>Yves Senn</em></p>
</li><li>
<p>Use <code>nil?</code> instead of <code>blank?</code> to check whether
dynamic finder with a bang should raise RecordNotFound. Fixes #7238.</p>

<p><em>Nikita Afanasenko</em></p>
</li><li>
<p>Fix deleting from a HABTM join table upon destroying an object of a model
with optimistic locking enabled. Fixes #5332.</p>

<p><em>Nick Rogers</em></p>
</li><li>
<p>Use query cache/uncache when using <a href=""DATABASE_URL"">ENV</a>. Fixes
#6951. Backport of #8074.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Do not create useless database transaction when building
<code>has_one</code> association.</p>

<p>Example:</p>

<pre><code>User.has_one :profile
User.new.build_profile</code></pre>

<p>Backport of #8154.</p>

<p><em>Bogdan Gusiev</em></p>
</li><li>
<p><code>AR::Base#attributes_before_type_cast</code> now returns unserialized
values for serialized attributes.</p>

<p><em>Nikita Afanasenko</em></p>
</li><li>
<p>Fix issue that raises <code>NameError</code> when overriding the
<code>accepts_nested_attributes</code> in child classes.</p>

<p>Before:</p>

<pre><code>class Shared::Person &lt; ActiveRecord::Base
  has_one :address

  accepts_nested_attributes :address, :reject_if =&gt; :all_blank
end

class Person &lt; Shared::Person
  accepts_nested_attributes :address
end

Person
#=&gt; NameError: method `address_attributes=&#39; not defined in Person
</code></pre>

<p>After:</p>

<pre><code>Person
#=&gt; Person(id: integer, ...)
</code></pre>

<p>Fixes #8131.</p>

<p><em>Gabriel Sobrinho, Ricardo Henrique</em></p>
</li></ul>

<h2 id="label-Rails+3.2.12+%28Feb+11%2C+2013%29">Rails 3.2.12 (Feb 11, 2013)</h2>
<ul><li>
<p>Quote numeric values being compared to non-numeric columns. Otherwise, in
some database, the string column values will be coerced to a numeric
allowing 0, 0.0 or false to match any string starting with a non-digit.</p>

<p>Example:</p>

<pre><code>App.where(apikey: 0) # =&gt; SELECT * FROM users WHERE apikey = &#39;0&#39;
</code></pre>

<p><em>Dylan Smith</em></p>
</li></ul>

<h2 id="label-Rails+3.2.11+%28Jan+8%2C+2013%29">Rails 3.2.11 (Jan 8, 2013)</h2>
<ul><li>
<p>Fix querying with an empty hash <em>Damien Mathieu</em> [CVE-2013-0155]</p>
</li></ul>

<h2 id="label-Rails+3.2.10+%28Jan+2%2C+2013%29">Rails 3.2.10 (Jan 2, 2013)</h2>
<ul><li>
<p>CVE-2012-5664 options hashes should only be extracted if there are extra
parameters</p>
</li></ul>

<h2 id="label-Rails+3.2.9+%28Nov+12%2C+2012%29">Rails 3.2.9 (Nov 12, 2012)</h2>
<ul><li>
<p>Fix <code>find_in_batches</code> crashing when IDs are strings and start
option is not specified.</p>

<p><em>Alexis Bernard</em></p>
</li><li>
<p>Fix issue with collection associations calling first(n)/last(n) and
attempting to set the inverse association when <code>:inverse_of</code> was
used. Fixes #8087.</p>

<p><em>Carlos Antonio da Silva</em></p>
</li><li>
<p>Fix bug when Column is trying to type cast boolean values to integer. Fixes
#8067.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Fix bug where <code>rake db:test:prepare</code> tries to load the
structure.sql into development database. Fixes #8032.</p>

<p><em>Grace Liu + Rafael Mendonça França</em></p>
</li><li>
<p>Fixed support for <code>DATABASE_URL</code> environment variable for rake
db tasks. <em>Grace Liu</em></p>
</li><li>
<p>Fix bug where <code>update_columns</code> and <code>update_column</code>
would not let you update the primary key column.</p>

<p><em>Henrik Nyh</em></p>
</li><li>
<p>Decode URI encoded attributes on database connection URLs.</p>

<p><em>Shawn Veader</em></p>
</li><li>
<p>Fix AR#dup to nullify the validation errors in the dup&#39;ed object.
Previously the original and the dup&#39;ed object shared the same errors.</p>

<p><em>Christian Seiler</em></p>
</li><li>
<p>Synchronize around deleting from the reserved connections hash. Fixes #7955</p>
</li><li>
<p>PostgreSQL adapter correctly fetches default values when using multiple
schemas and domains in a db. Fixes #7914</p>

<p><em>Arturo Pie</em></p>
</li><li>
<p>Fix deprecation notice when loading a collection association that selects
columns from other tables, if a new record was previously built using that
association.</p>

<p><em>Ernie Miller</em></p>
</li><li>
<p>The postgres adapter now supports tables with capital letters. Fix #5920</p>

<p><em>Yves Senn</em></p>
</li><li>
<p><code>CollectionAssociation#count</code> returns <code>0</code> without
querying if the parent record is not persisted.</p>

<p>Before:</p>

<pre><code>person.pets.count
# SELECT COUNT(*) FROM &quot;pets&quot; WHERE &quot;pets&quot;.&quot;person_id&quot; IS NULL
# =&gt; 0
</code></pre>

<p>After:</p>

<pre><code>person.pets.count
# fires without sql query
# =&gt; 0
</code></pre>

<p><em>Francesco Rodriguez</em></p>
</li><li>
<p>Fix <code>reset_counters</code> crashing on <code>has_many :through</code>
associations. Fix #7822.</p>

<p><em>lulalala</em></p>
</li><li>
<p>ConnectionPool recognizes checkout_timeout spec key as taking precedence
over legacy wait_timeout spec key, can be used to avoid conflict with
mysql2 use of wait_timeout. Closes #7684.</p>

<p><em>jrochkind</em></p>
</li><li>
<p>Rename field_changed? to _field_changed? so that users can create a field
named field</p>

<p><em>Akira Matsuda</em>, backported by <em>Steve Klabnik</em></p>
</li><li>
<p>Fix creation of through association models when using
<code>collection=[]</code> on a <code>has_many :through</code> association
from an unsaved model. Fix #7661.</p>

<p><em>Ernie Miller</em></p>
</li><li>
<p>Explain only normal CRUD sql (select / update / insert / delete). Fix
problem that explains unexplainable sql. Closes #7544 #6458.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Backport test coverage to ensure that PostgreSQL auto-reconnect
functionality remains healthy.</p>

<p><em>Steve Jorgensen</em></p>
</li><li>
<p>Use <a href="'encoding'">config</a> instead of <a
href="'charset'">config</a> when executing databases.rake in the
mysql/mysql2. A correct option for a database.yml is &#39;encoding&#39;.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Fix ConnectionAdapters::Column.type_cast_code integer conversion, to always
convert values to integer calling to_i. Fixes #7509.</p>

<p><em>Thiago Pradi</em></p>
</li><li>
<p>Fix time column type casting for invalid time string values to correctly
return nil.</p>

<p><em>Adam Meehan</em></p>
</li><li>
<p>Fix <code>becomes</code> when using a configured
<code>inheritance_column</code>.</p>

<p><em>Yves Senn</em></p>
</li><li>
<p>Fix <code>reset_counters</code> when there are multiple
<code>belongs_to</code> association with the same foreign key and one of
them have a counter cache. Fixes #5200.</p>

<p><em>Dave Desrochers</em></p>
</li><li>
<p>Round usec when comparing timestamp attributes in the dirty tracking. Fixes
#6975.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Use inversed parent for first and last child of has_many association.</p>

<p><em>Ravil Bayramgalin</em></p>
</li><li>
<p>Fix Column.microseconds and Column.fast_string_to_date to avoid converting
timestamp seconds to a float, since it occasionally results in inaccuracies
with microsecond-precision times. Fixes #7352.</p>

<p><em>Ari Pollak</em></p>
</li><li>
<p>Fix <code>increment!</code>, <code>decrement!</code>, <code>toggle!</code>
that was skipping callbacks. Fixes #7306.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Fix AR#create to return an unsaved record when AR::RecordInvalid is raised.
Fixes #3217.</p>

<p><em>Dave Yeu</em></p>
</li><li>
<p>Remove unnecessary transaction when assigning has_one associations with a
nil or equal value. Fix #7191.</p>

<p><em>kennyj</em></p>
</li><li>
<p>Allow store to work with an empty column. Fix #4840.</p>

<p><em>Jeremy Walker</em></p>
</li><li>
<p>Remove prepared statement from system query in postgresql adapter. Fix
#5872.</p>

<p><em>Ivan Evtuhovich</em></p>
</li><li>
<p>Make sure <code>:environment</code> task is executed before
<code>db:schema:load</code> or <code>db:structure:load</code> Fixes #4772.</p>

<p><em>Seamus Abshere</em></p>
</li></ul>

<h2 id="label-Rails+3.2.8+%28Aug+9%2C+2012%29">Rails 3.2.8 (Aug 9, 2012)</h2>
<ul><li>
<p>Do not consider the numeric attribute as changed if the old value is zero
and the new value is not a string. Fixes #7237.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Removes the deprecation of <code>update_attribute</code>. <em>fxn</em></p>
</li><li>
<p>Reverted the deprecation of <code>composed_of</code>. <em>Rafael Mendonça
França</em></p>
</li><li>
<p>Reverted the deprecation of <code>*_sql</code> association options. They
will be deprecated in 4.0 instead. <em>Jon Leighton</em></p>
</li><li>
<p>Do not eager load AR session store. <a
href="../../classes/ActiveRecord/SessionStore.html">ActiveRecord::SessionStore</a>
depends on the abstract store in Action Pack. Eager loading this class
would break client code that eager loads Active Record standalone. Fixes
#7160</p>

<p><em>Xavier Noria</em></p>
</li><li>
<p>Do not set RAILS_ENV to "development" when using
<code>db:test:prepare</code> and related rake tasks. This was causing the
truncation of the development database data when using RSpec. Fixes #7175.</p>

<p><em>Rafael Mendonça França</em></p>
</li></ul>

<h2 id="label-Rails+3.2.7+%28Jul+26%2C+2012%29">Rails 3.2.7 (Jul 26, 2012)</h2>
<ul><li>
<p><code>:finder_sql</code> and <code>:counter_sql</code> options on
collection associations are deprecated. Please transition to using scopes.</p>

<p><em>Jon Leighton</em></p>
</li><li>
<p><code>:insert_sql</code> and <code>:delete_sql</code> options on
<code>has_and_belongs_to_many</code> associations are deprecated. Please
transition to using <code>has_many :through</code></p>

<p><em>Jon Leighton</em></p>
</li><li>
<p><code>composed_of</code> has been deprecated. You&#39;ll have to write your
own accessor and mutator methods if you&#39;d like to use value objects to
represent some portion of your models.</p>

<p><em>Steve Klabnik</em></p>
</li><li>
<p><code>update_attribute</code> has been deprecated. Use
<code>update_column</code> if you want to bypass mass-assignment
protection, validations, callbacks, and touching of updated_at. Otherwise
please use <code>update_attributes</code>.</p>

<p><em>Steve Klabnik</em></p>
</li></ul>

<h2 id="label-Rails+3.2.6+%28Jun+12%2C+2012%29">Rails 3.2.6 (Jun 12, 2012)</h2>
<ul><li>
<p>protect against the nesting of hashes changing the table context in the
next call to build_from_hash. This fix covers this case as well.</p>

<p>CVE-2012-2695</p>
</li><li>
<p>Revert earlier &#39;perf fix&#39; (see 3.2.4 changelog / GH #6289). This
change introduced a regression (GH #6609). assoc.clear and assoc.delete_all
have loaded the association before doing the delete since at least Rails
2.3. Doing the delete without loading the records means that the
<code>before_remove</code> and <code>after_remove</code> callbacks do not
get invoked. Therefore, this change was less a fix a more an optimisation,
which should only have gone into master.</p>

<p><em>Jon Leighton</em></p>
</li></ul>

<h2 id="label-Rails+3.2.5+%28Jun+1%2C+2012%29">Rails 3.2.5 (Jun 1, 2012)</h2>
<ul><li>
<p>Restore behavior of Active Record 3.2.3 scopes. A series of commits
relating to preloading and scopes caused a regression.</p>

<p><em>Andrew White</em></p>
</li></ul>

<h2 id="label-Rails+3.2.4+%28May+31%2C+2012%29">Rails 3.2.4 (May 31, 2012)</h2>
<ul><li>
<p>Perf fix: Don&#39;t load the records when doing assoc.delete_all. GH #6289.
<em>Jon Leighton</em></p>
</li><li>
<p>Association preloading shouldn&#39;t be affected by the current scoping.
This could cause infinite recursion and potentially other problems. See GH
#5667. <em>Jon Leighton</em></p>
</li><li>
<p>Datetime attributes are forced to be changed. GH #3965</p>
</li><li>
<p>Fix attribute casting. GH #5549</p>
</li><li>
<p>Fix #5667. Preloading should ignore scoping.</p>
</li><li>
<p>Predicate builder should not recurse for determining where columns. Thanks
to Ben Murphy for reporting this! CVE-2012-2661</p>
</li></ul>

<h2 id="label-Rails+3.2.3+%28March+30%2C+2012%29">Rails 3.2.3 (March 30, 2012)</h2>
<ul><li>
<p>Added find_or_create_by_{attribute}! dynamic method. <em>Andrew White</em></p>
</li><li>
<p>Whitelist all attribute assignment by default. Change the default for newly
generated applications to whitelist all attribute assignment. Also update
the generated model classes so users are reminded of the importance of
attr_accessible. <em>NZKoz</em></p>
</li><li>
<p>Update ActiveRecord::AttributeMethods#attribute_present? to return false
for empty strings. <em>Jacobkg</em></p>
</li><li>
<p>Fix associations when using per class databases. <em>larskanis</em></p>
</li><li>
<p>Revert setting NOT NULL constraints in add_timestamps <em>fxn</em></p>
</li><li>
<p>Fix mysql to use proper text types. Fixes #3931. <em>kennyj</em></p>
</li><li>
<p>Fix #5069 - Protect foreign key from mass assignment through association
builder. <em>byroot</em></p>
</li></ul>

<h2 id="label-Rails+3.2.2+%28March+1%2C+2012%29">Rails 3.2.2 (March 1, 2012)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+3.2.1+%28January+26%2C+2012%29">Rails 3.2.1 (January 26, 2012)</h2>
<ul><li>
<p>The threshold for auto EXPLAIN is ignored if there&#39;s no logger.
<em>fxn</em></p>
</li><li>
<p>Call <code>to_s</code> on the value passed to <code>table_name=</code>, in
particular symbols are supported (regression). <em>Sergey Nartimov</em></p>
</li><li>
<p>Fix possible race condition when two threads try to define attribute
methods for the same class. <em>Jon Leighton</em></p>
</li></ul>

<h2 id="label-Rails+3.2.0+%28January+20%2C+2012%29">Rails 3.2.0 (January 20, 2012)</h2>
<ul><li>
<p>Added a <code>with_lock</code> method to ActiveRecord objects, which starts
a transaction, locks the object (pessimistically) and yields to the block.
The method takes one (optional) parameter and passes it to
<code>lock!</code>.</p>

<p>Before:</p>

<pre><code>class Order &lt; ActiveRecord::Base
  def cancel!
    transaction do
      lock!
      # ... cancelling logic
    end
  end
end
</code></pre>

<p>After:</p>

<pre><code>class Order &lt; ActiveRecord::Base
  def cancel!
    with_lock do
      # ... cancelling logic
    end
  end
end
</code></pre>

<p><em>Olek Janiszewski</em></p>
</li><li>
<p>&#39;on&#39; and &#39;ON&#39; boolean columns values are type casted to
true <em>Santiago Pastorino</em></p>
</li><li>
<p>Added ability to run migrations only for given scope, which allows to run
migrations only from one engine (for example to revert changes from engine
that you want to remove).</p>

<p>Example:  rake db:migrate SCOPE=blog</p>

<p><em>Piotr Sarnacki</em></p>
</li><li>
<p>Migrations copied from engines are now scoped with engine&#39;s name, for
example 01_create_posts.blog.rb. <em>Piotr Sarnacki</em></p>
</li><li>
<p>Implements <code>AR::Base.silence_auto_explain</code>. This method allows
the user to selectively disable automatic EXPLAINs within a block.
<em>fxn</em></p>
</li><li>
<p>Implements automatic EXPLAIN logging for slow queries.</p>

<p>A new configuration parameter
<code>config.active_record.auto_explain_threshold_in_seconds</code>
determines what&#39;s to be considered a slow query. Setting that to
<code>nil</code> disables this feature. Defaults are 0.5 in development
mode, and <code>nil</code> in test and production modes.</p>

<p>As of this writing there&#39;s support for SQLite, MySQL (mysql2 adapter),
and PostgreSQL.</p>

<p><em>fxn</em></p>
</li><li>
<p>Implemented <a
href="../../classes/ActiveRecord/Calculations.html#method-i-pluck">ActiveRecord::Calculations#pluck</a>
method</p>

<p>Method returns <a href="../../classes/Array.html">Array</a> of column value
from table under ActiveRecord model</p>

<pre><code>Client.pluck(:id)</code></pre>

<p><em>Bogdan Gusiev</em></p>
</li><li>
<p>Automatic closure of connections in threads is deprecated. For example the
following code is deprecated:</p>

<p>Thread.new { Post.find(1) }.join</p>

<p>It should be changed to close the database connection at the end of the
thread:</p>

<p>Thread.new {  Post.find(1)  Post.connection.close }.join</p>

<p>Only people who spawn threads in their application code need to worry about
this change.</p>
</li><li>
<p>Deprecated:</p>
<ul><li>
<p><code>set_table_name</code></p>
</li><li>
<p><code>set_inheritance_column</code></p>
</li><li>
<p><code>set_sequence_name</code></p>
</li><li>
<p><code>set_primary_key</code></p>
</li><li>
<p><code>set_locking_column</code></p>
</li></ul>

<p>Use an assignment method instead. For example, instead of
<code>set_table_name</code>, use <code>self.table_name=</code>:</p>

<pre><code> class Project &lt; ActiveRecord::Base
   self.table_name = &quot;project&quot;
 end
</code></pre>

<p>Or define your own <code>self.table_name</code> method:</p>

<pre><code> class Post &lt; ActiveRecord::Base
   def self.table_name
     &quot;special_&quot; + super
   end
 end
 Post.table_name # =&gt; &quot;special_posts&quot;
</code></pre>

<p><em>Jon Leighton</em></p>
</li><li>
<p>Generated association methods are created within a separate module to allow
overriding and composition using <code>super</code>. For a class named
<code>MyModel</code>, the module is named
<code>MyModel::GeneratedFeatureMethods</code>. It is included into the
model class immediately after the <code>generated_attributes_methods</code>
module defined in <a href="../../classes/ActiveModel.html">ActiveModel</a>,
so association methods override attribute methods of the same name.
<em>Josh Susser</em></p>
</li><li>
<p>Implemented <a
href="../../classes/ActiveRecord/Relation.html#method-i-explain">ActiveRecord::Relation#explain</a>.
<em>fxn</em></p>
</li><li>
<p>Add <a
href="../../classes/ActiveRecord/QueryMethods.html#method-i-uniq">ActiveRecord::QueryMethods#uniq</a>
for generating unique queries.</p>

<p>Before:</p>

<pre><code>Client.select(&#39;DISTINCT name&#39;)</code></pre>

<p>After:</p>

<pre><code>Client.select(:name).uniq</code></pre>

<p>This also allows you to revert the unqueness in a relation:</p>

<pre><code>Client.select(:name).uniq.uniq(false)</code></pre>

<p><em>Jon Leighton</em></p>
</li><li>
<p>Support index sort order in sqlite, mysql and postgres adapters. <em>Vlad
Jebelev</em></p>
</li><li>
<p>Allow the :class_name option for associations to take a symbol (:Client) in
addition to a string (&#39;Client&#39;).</p>

<p>This is to avoid confusing newbies, and to be consistent with the fact that
other options like :foreign_key already allow a symbol or a string.</p>

<p><em>Jon Leighton</em></p>
</li><li>
<p>In development mode the db:drop task also drops the test database. For
symmetry with the db:create task. <em>Dmitriy Kiriyenko</em></p>
</li><li>
<p>Added ActiveRecord::Base.store for declaring simple single-column key/value
stores <em>DHH</em></p>

<pre><code>class User &lt; ActiveRecord::Base
  store :settings, accessors: [ :color, :homepage ]
end

u = User.new(color: &#39;black&#39;, homepage: &#39;37signals.com&#39;)
u.color                          # Accessor stored attribute
u.settings[:country] = &#39;Denmark&#39; # Any attribute, even if not specified with an accessor
</code></pre>
</li><li>
<p>MySQL: case-insensitive uniqueness validation avoids calling LOWER when the
column already uses a case-insensitive collation. Fixes #561.</p>

<p><em>Joseph Palermo</em></p>
</li><li>
<p>Transactional fixtures enlist all active database connections. You can test
models on different connections without disabling transactional fixtures.</p>

<p><em>Jeremy Kemper</em></p>
</li><li>
<p>Add first_or_create, first_or_create!, first_or_initialize methods to
Active Record. This is a better approach over the old find_or_create_by
dynamic methods because it&#39;s clearer which arguments are used to find
the record and which are used to create it:</p>

<pre><code>User.where(:first_name =&gt; &quot;Scarlett&quot;).first_or_create!(:last_name =&gt; &quot;Johansson&quot;)
</code></pre>

<p><em>Andrés Mejía</em></p>
</li><li>
<p>Fix nested attributes bug where _destroy parameter is taken into account
during :reject_if =&gt; :all_blank (fixes #2937)</p>

<p><em>Aaron Christy</em></p>
</li><li>
<p>Add <a
href="../../classes/ActiveSupport/Cache/NullStore.html">ActiveSupport::Cache::NullStore</a>
for use in development and testing.</p>

<p><em>Brian Durand</em></p>
</li></ul>

<p>Please check <a
href="https://github.com/rails/rails/blob/3-1-stable/activerecord/CHANGELOG.md">3-1-stable</a>
for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>

    </div>
  </body>
</html>
